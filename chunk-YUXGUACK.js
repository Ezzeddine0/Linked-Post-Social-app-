import{a as ot,b as nt}from"./chunk-SCTZ3JU4.js";import{p as it}from"./chunk-YIGV4GGE.js";import{l as et}from"./chunk-OYOCP6AY.js";import{$ as z,Bb as p,Cb as S,Ib as J,Ja as D,Lb as Q,Ma as d,Mb as tt,N as T,Na as C,O as N,T as k,Ua as B,Y as v,a as I,aa as L,ab as b,b as W,ba as R,bb as A,cb as V,eb as g,ia as j,ib as _,kb as X,lb as $,mb as c,n as M,nb as s,ob as h,pa as Y,qa as y,r as w,sb as G,t as K,tb as q,wb as Z,y as U,z as F}from"./chunk-SKZUZ3B6.js";function ut(t,e,i,o){let n=window&&!!window.document&&window.document.documentElement,l=n&&e?window:i;if(t&&(l=t&&n&&typeof t=="string"?ht(t,i.nativeElement,o):t,!l))throw new Error("ngx-infinite-scroll {resolveContainerElement()}: selector for");return l}function ht(t,e,i){return(i?window.document:e).querySelector(t)}function E(t){return t&&!t.firstChange}function mt(){return typeof window<"u"}var gt={clientHeight:"clientHeight",offsetHeight:"offsetHeight",scrollHeight:"scrollHeight",pageYOffset:"pageYOffset",offsetTop:"offsetTop",scrollTop:"scrollTop",top:"top"},St={clientHeight:"clientWidth",offsetHeight:"offsetWidth",scrollHeight:"scrollWidth",pageYOffset:"pageXOffset",offsetTop:"offsetLeft",scrollTop:"scrollLeft",top:"left"},P=class{constructor(e=!0){this.vertical=e,this.propsMap=e?gt:St}clientHeightKey(){return this.propsMap.clientHeight}offsetHeightKey(){return this.propsMap.offsetHeight}scrollHeightKey(){return this.propsMap.scrollHeight}pageYOffsetKey(){return this.propsMap.pageYOffset}offsetTopKey(){return this.propsMap.offsetTop}scrollTopKey(){return this.propsMap.scrollTop}topKey(){return this.propsMap.top}};function wt(t,e,i){return!!(t&&e||!i&&e)}function Tt({windowElement:t,axis:e}){return vt({axis:e,isWindow:yt(t)},t)}function vt(t,e){let i=t.isWindow||e&&!e.nativeElement?e:e.nativeElement;return W(I({},t),{container:i})}function yt(t){return["Window","global"].some(i=>Object.prototype.toString.call(t).includes(i))}function H(t,e){return t?e.document.documentElement:null}function lt(t,e){let i=bt(e);return e.isWindow?Dt(i,t,e):Ct(i,t,e)}function Dt(t,e,i){let{axis:o,container:n,isWindow:l}=i,{offsetHeightKey:r,clientHeightKey:f}=rt(o),u=t+ct(H(l,n),o,l),a=st(e.nativeElement,l,r,f),m=_t(e.nativeElement,o,l)+a;return{height:t,scrolled:u,totalToScroll:m,isWindow:l}}function Ct(t,e,i){let{axis:o,container:n}=i,l=n[o.scrollTopKey()],r=n[o.scrollHeightKey()];return{height:t,scrolled:l,totalToScroll:r,isWindow:!1}}function rt(t){return{offsetHeightKey:t.offsetHeightKey(),clientHeightKey:t.clientHeightKey()}}function bt({container:t,isWindow:e,axis:i}){let{offsetHeightKey:o,clientHeightKey:n}=rt(i);return st(t,e,o,n)}function st(t,e,i,o){if(isNaN(t[i])){let n=H(e,t);return n?n[o]:0}else return t[i]}function _t(t,e,i){let o=e.topKey();if(t.getBoundingClientRect)return t.getBoundingClientRect()[o]+ct(t,e,i)}function ct(t,e,i){let o=e.pageYOffsetKey(),n=e.scrollTopKey(),l=e.offsetTopKey();return isNaN(window.pageYOffset)?H(i,t)[n]:t.ownerDocument?t.ownerDocument.defaultView[o]:t[l]}function Et(t,e={down:0,up:0},i){let o,n;if(t.totalToScroll<=0)return!1;let l=t.isWindow?t.scrolled:t.height+t.scrolled;if(i)o=(t.totalToScroll-l)/t.totalToScroll,n=(e?.down?e.down:0)/10;else{let f=t.scrolled+(t.totalToScroll-l);o=t.scrolled/f,n=(e?.up?e.up:0)/10}return o<=n}function Pt(t,e){return t<e.scrolled}function xt(t,e,i){let o=Pt(t,e);return{fire:Et(e,i,o),scrollDown:o}}var x=class{constructor(e){this.lastScrollPosition=0,this.lastTotalToScroll=0,this.totalToScroll=0,this.triggered={down:0,up:0},Object.assign(this,e)}updateScrollPosition(e){return this.lastScrollPosition=e}updateTotalToScroll(e){this.lastTotalToScroll!==e&&(this.lastTotalToScroll=this.totalToScroll,this.totalToScroll=e)}updateScroll(e,i){this.updateScrollPosition(e),this.updateTotalToScroll(i)}updateTriggeredFlag(e,i){i?this.triggered.down=e:this.triggered.up=e}isTriggeredScroll(e,i){return i?this.triggered.down===e:this.triggered.up===e}};function Ot(t){let{scrollContainer:e,scrollWindow:i,element:o,fromRoot:n}=t,l=Tt({axis:new P(!t.horizontal),windowElement:ut(e,i,o,n)}),r=new x({totalToScroll:lt(o,l).totalToScroll}),f={container:l.container,throttle:t.throttle},u={up:t.upDistance,down:t.downDistance};return Ht(f).pipe(K(()=>M(lt(o,l))),w(a=>It(r.lastScrollPosition,a,u)),T(({stats:a})=>r.updateScroll(a.scrolled,a.totalToScroll)),F(({fire:a,scrollDown:m,stats:{totalToScroll:ft}})=>wt(t.alwaysCallback,a,r.isTriggeredScroll(ft,m))),T(({scrollDown:a,stats:{totalToScroll:m}})=>{r.updateTriggeredFlag(m,a)}),w(Wt))}function Ht(t){let e=U(t.container,"scroll");return t.throttle&&(e=e.pipe(N(t.throttle,void 0,{leading:!0,trailing:!0}))),e}function It(t,e,i){let{scrollDown:o,fire:n}=xt(t,e,i);return{scrollDown:o,fire:n,stats:e}}var O={DOWN:"[NGX_ISE] DOWN",UP:"[NGX_ISE] UP"};function Wt(t){let{scrollDown:e,stats:{scrolled:i}}=t;return{type:e?O.DOWN:O.UP,payload:{currentScrollPosition:i}}}var at=(()=>{class t{constructor(i,o){this.element=i,this.zone=o,this.scrolled=new y,this.scrolledUp=new y,this.infiniteScrollDistance=2,this.infiniteScrollUpDistance=1.5,this.infiniteScrollThrottle=150,this.infiniteScrollDisabled=!1,this.infiniteScrollContainer=null,this.scrollWindow=!0,this.immediateCheck=!1,this.horizontal=!1,this.alwaysCallback=!1,this.fromRoot=!1}ngAfterViewInit(){this.infiniteScrollDisabled||this.setup()}ngOnChanges({infiniteScrollContainer:i,infiniteScrollDisabled:o,infiniteScrollDistance:n}){let l=E(i),r=E(o),f=E(n),u=!r&&!this.infiniteScrollDisabled||r&&!o.currentValue||f;(l||r||f)&&(this.destroyScroller(),u&&this.setup())}setup(){mt()&&this.zone.runOutsideAngular(()=>{this.disposeScroller=Ot({fromRoot:this.fromRoot,alwaysCallback:this.alwaysCallback,disable:this.infiniteScrollDisabled,downDistance:this.infiniteScrollDistance,element:this.element,horizontal:this.horizontal,scrollContainer:this.infiniteScrollContainer,scrollWindow:this.scrollWindow,throttle:this.infiniteScrollThrottle,upDistance:this.infiniteScrollUpDistance}).subscribe(i=>this.handleOnScroll(i))})}handleOnScroll({type:i,payload:o}){let n=i===O.DOWN?this.scrolled:this.scrolledUp;Mt(n)&&this.zone.run(()=>n.emit(o))}ngOnDestroy(){this.destroyScroller()}destroyScroller(){this.disposeScroller&&this.disposeScroller.unsubscribe()}static{this.\u0275fac=function(o){return new(o||t)(C(Y),C(B))}}static{this.\u0275dir=R({type:t,selectors:[["","infiniteScroll",""],["","infinite-scroll",""],["","data-infinite-scroll",""]],inputs:{infiniteScrollDistance:"infiniteScrollDistance",infiniteScrollUpDistance:"infiniteScrollUpDistance",infiniteScrollThrottle:"infiniteScrollThrottle",infiniteScrollDisabled:"infiniteScrollDisabled",infiniteScrollContainer:"infiniteScrollContainer",scrollWindow:"scrollWindow",immediateCheck:"immediateCheck",horizontal:"horizontal",alwaysCallback:"alwaysCallback",fromRoot:"fromRoot"},outputs:{scrolled:"scrolled",scrolledUp:"scrolledUp"},features:[j]})}}return t})();function Mt(t){return t.observed??t.observers.length>0}var dt=(()=>{class t{static{this.\u0275fac=function(o){return new(o||t)}}static{this.\u0275mod=L({type:t})}static{this.\u0275inj=k({})}}return t})();var Ut=(t,e)=>e._id,Ft=()=>[import("./chunk-7ZJWQRNJ.js").then(t=>t.CommentsComponent)];function Nt(t,e){if(t&1&&h(0,"app-comments",15),t&2){let i=q().$implicit;g("postId",i._id)}}function kt(t,e){t&1&&(c(0,"h5",16),p(1,"Loading ...."),s())}function zt(t,e){if(t&1&&(c(0,"article",2)(1,"div",7)(2,"div",8),h(3,"img",9),c(4,"div")(5,"p",10),p(6),s(),c(7,"small",11),p(8),Q(9,"date"),s()()(),c(10,"p",12),p(11),s(),h(12,"img",13),s(),c(13,"button",14,0),p(15," Show Comments "),s(),b(16,Nt,1,1)(17,kt,2,0),A(18,16,Ft,17),V(13),s()),t&2){let i=e.$implicit;d(3),g("src",i.user.photo,D)("alt",i.user.name),d(3),S(i.user.name),d(2),S(tt(9,6,i.createdAt)),d(3),S(i.body),d(),g("src",i.image,D)}}function Lt(t,e){t&1&&(c(0,"div",5)(1,"p"),p(2,"Loading more posts..."),s()())}function Rt(t,e){t&1&&(c(0,"div",6)(1,"p"),p(2,"No more posts to load."),s()())}var le=(()=>{class t{constructor(){this._UsersService=v(it),this._PostsService=v(ot),this.userData={},this.posts=[],this.page=1,this.limit=10,this.loading=!1,this.allLoaded=!1}ngOnInit(){this.loadUserData(),this.loadPosts()}loadUserData(){this._UsersService.getLoggedUserData().subscribe({next:i=>{console.log(i),this.userData=i.user},error:i=>console.log(i)})}loadPosts(){this.loading||this.allLoaded||(this.loading=!0,this._PostsService.getAllPosts(this.page,this.limit).subscribe({next:i=>{console.log(i);let o=i.posts;!o||o.length===0?this.allLoaded=!0:(this.posts=[...this.posts,...o],this.page=i.paginationInfo.nextPage||this.page+1,this.page>i.paginationInfo.numberOfPages&&(this.allLoaded=!0)),this.loading=!1},error:i=>{console.log(i),this.loading=!1}}))}onScrollDown(){this.loadPosts()}static{this.\u0275fac=function(o){return new(o||t)}}static{this.\u0275cmp=z({type:t,selectors:[["app-timeline"]],standalone:!0,features:[J],decls:8,vars:6,consts:[["showComments",""],["infiniteScroll","",1,"timeline-container",3,"scrolled","infiniteScrollDistance","infiniteScrollThrottle"],[1,"w-50","w-md-100","mx-auto","bg-light","p-5","border","mb-4"],["type","button","data-bs-toggle","modal","data-bs-target","#exampleModal","data-bs-whatever","@mdo","type","text",1,"w-100","p-2","rounded-pill",3,"placeholder"],["postId",""],[1,"text-center","py-3"],[1,"text-center","text-muted","py-3"],[1,"d-flex","flex-column","gap-3"],[1,"d-flex","align-items-center","gap-3"],["width","50","height","50",1,"rounded-circle",3,"src","alt"],[1,"fw-bolder","mb-0"],[1,"text-muted"],[1,"fw-bold"],["alt","",1,"w-100","rounded",3,"src"],[1,"btn","commentsBut","fw-bold","mt-3"],[3,"postId"],[1,"text-center","h5","text-muted"]],template:function(o,n){o&1&&(c(0,"div",1),G("scrolled",function(){return n.onScrollDown()}),c(1,"div",2),h(2,"input",3),s(),h(3,"app-posts",4),X(4,zt,20,8,"article",2,Ut),b(6,Lt,3,0,"div",5)(7,Rt,3,0,"div",6),s()),o&2&&(g("infiniteScrollDistance",2)("infiniteScrollThrottle",150),d(2),Z("placeholder","what's on your mind, ",n.userData.name,"?"),d(2),$(n.posts),d(2),_(6,n.loading?6:-1),d(),_(7,n.allLoaded?7:-1))},dependencies:[et,dt,at,nt],styles:["input[_ngcontent-%COMP%]{border-color:#0006}@media (max-width: 1000px){.w-md-100[_ngcontent-%COMP%]{width:100%!important}}.commentsBut[_ngcontent-%COMP%]{border:none;color:var(--main-color)}.bgeee[_ngcontent-%COMP%]{background-color:#eee}"]})}}return t})();export{le as TimelineComponent};
