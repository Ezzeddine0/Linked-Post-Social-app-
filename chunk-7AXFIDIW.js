import{a as N,c as j,d as B,f as L,g as H,h as P,i as G,n as W,o as A,p as O,q as f,r as R}from"./chunk-AZPCGIVJ.js";import{k as $,r as U}from"./chunk-L3S2AP4B.js";import{$ as S,Ab as c,Bb as v,Cb as F,Db as I,Eb as k,Fb as V,Hb as M,Jb as T,Kb as D,Ma as s,S as w,Y as a,ab as x,eb as g,ib as b,ja as p,jb as y,ka as u,kb as E,lb as o,mb as r,nb as C,ob as h,rb as _,sb as m}from"./chunk-SER4P5WU.js";var Y=(()=>{class e{constructor(){this._HttpClient=a(U)}createComment(t){return this._HttpClient.post(`${f.baseUrl}/comments`,t)}getPostsComments(t){return this._HttpClient.get(`${f.baseUrl}/posts/${t}/comments`)}updateComment(t,n){return this._HttpClient.put(`${f.baseUrl}/comments/${t}`,n)}deleteComment(t){return this._HttpClient.delete(`${f.baseUrl}/comments/${t}`)}static{this.\u0275fac=function(n){return new(n||e)}}static{this.\u0275prov=w({token:e,factory:e.\u0275fac,providedIn:"root"})}}return e})();var z=(e,d)=>d._id;function J(e,d){if(e&1){let t=h();o(0,"div",13)(1,"button",15)(2,"p",16),c(3,"..."),r()(),o(4,"ul",17)(5,"li")(6,"button",18),_("click",function(){p(t);let i=m().$implicit,l=m();return u(l.startEdit(i))}),c(7," Edit "),r()(),o(8,"li"),C(9,"hr",19),r(),o(10,"li")(11,"button",20),_("click",function(){p(t);let i=m().$implicit,l=m();return u(l.deleteComment(i._id))}),c(12," Delete "),r()()()()}}function K(e,d){if(e&1&&(o(0,"p",14),c(1),r()),e&2){let t=m().$implicit;s(),v(t.content)}}function Q(e,d){if(e&1){let t=h();o(0,"div",21)(1,"input",22),V("ngModelChange",function(i){p(t);let l=m(2);return k(l.editContent,i)||(l.editContent=i),u(i)}),r(),o(2,"button",23),_("click",function(){p(t);let i=m().$implicit,l=m();return u(l.saveEdit(i._id))}),c(3," Save "),r(),o(4,"button",24),_("click",function(){p(t);let i=m(2);return u(i.cancelEdit())}),c(5," Cancel "),r()()}if(e&2){let t=m(2);s(),I("ngModel",t.editContent),s(),g("disabled",!t.editContent.trim())}}function X(e,d){if(e&1&&(o(0,"div",1)(1,"div",8)(2,"div",9),C(3,"img",10),o(4,"p",11),c(5),r(),o(6,"p",12),c(7),T(8,"date"),r()(),x(9,J,13,0,"div",13),r(),x(10,K,2,1,"p",14)(11,Q,6,2),r()),e&2){let t=d.$implicit,n=m();s(5),F(" ",t.commentCreator.name," "),s(2),v(D(8,4,t.createdAt)),s(2),b(9,t.commentCreator._id===n.userData._id?9:-1),s(),b(10,n.editingCommentId!==t._id?10:11)}}var pt=(()=>{class e{constructor(){this._commentService=a(Y),this._FormBuilder=a(W),this._UsersService=a(R),this.selectedCommentId="",this.comments=[],this.isLoading=!1,this.editingCommentId=null,this.editContent=""}ngOnInit(){this.commentForm=this._FormBuilder.group({content:[null],post:[this.postId]}),this.getComments(),this.loadUserData()}loadUserData(){this._UsersService.getLoggedUserData().subscribe({next:t=>{console.log(t),this.userData=t.user},error:t=>console.log(t)})}getComments(){this._commentService.getPostsComments(this.postId).subscribe({next:t=>{console.log(t),this.comments=t.comments.reverse()},error:t=>{console.log(t)}})}submitComment(){this.isLoading=!0,this._commentService.createComment(this.commentForm.value).subscribe({next:t=>{console.log(t),this.isLoading=!1,this.comments=t.comments.reverse(),this.commentForm.get("content")?.reset()},error:t=>{this.isLoading=!1,console.log(t)}})}deleteComment(t){this._commentService.deleteComment(t).subscribe({next:n=>{this.getComments(),console.log(n)},error:n=>{console.log(n)}})}startEdit(t){this.editingCommentId=t._id,this.editContent=t.content}cancelEdit(){this.editingCommentId=null,this.editContent=""}saveEdit(t){let n={content:this.editContent};this._commentService.updateComment(t,n).subscribe({next:i=>{this.cancelEdit(),this.getComments()},error(i){console.log(i)}})}static{this.\u0275fac=function(n){return new(n||e)}}static{this.\u0275cmp=S({type:e,selectors:[["app-comments"]],inputs:{postId:"postId"},standalone:!0,features:[M],decls:9,vars:2,consts:[[1,"comments"],[1,"p-4","mb-2","bgeee","border"],["action","",3,"ngSubmit","formGroup"],[1,"bgeee","d-flex","gap-2","p-3","align-items-center","mt-2"],["name","content","id","content","formControlName","content","placeholder","Your Comment","type","text",1,"form-control","p-2","rounded"],["name","post","id","post","formControlName","post","type","hidden",1,"form-control","p-2","rounded"],["type","submit",1,"btn","text-center",3,"disabled"],[1,"fa-solid","fa-paper-plane","fs-4"],[1,"d-flex","justify-content-between","align-items-center"],[1,"d-flex","gap-3","align-items-center"],["src","./assets/images/profile.png","width","30px","height","30px","alt","",1,"rounded-circle"],[1,"fw-bolder","m-0"],[1,"text-muted","m-0"],[1,"dropdown","d-flex","align-items-center","justify-content-center"],[1,"fw-bold","text-muted","mb-0"],["type","button","id","dropdownMenuButton","data-bs-toggle","dropdown","aria-expanded","false",1,"btn","p-0","d-flex","align-items-center","justify-content-center"],[1,"h2","fw-bold","m-0"],["aria-labelledby","dropdownMenuButton",1,"dropdown-menu","dropdown-menu-end",2,"width","auto","min-width","fit-content"],[1,"dropdown-item","text-main","text-center","fw-bold",3,"click"],[1,"dropdown-divider"],[1,"dropdown-item","text-danger","fw-bold",3,"click"],[1,"d-flex","gap-2","align-items-center","mt-2"],["placeholder","Edit your comment","type","text",1,"form-control","p-2","rounded","flex-grow-1",3,"ngModelChange","ngModel"],[1,"btn","btn-sm","btn-success",3,"click","disabled"],[1,"btn","btn-sm","btn-secondary",3,"click"]],template:function(n,i){n&1&&(o(0,"section",0),y(1,X,12,6,"div",1,z),r(),o(3,"form",2),_("ngSubmit",function(){return i.submitComment()}),o(4,"div",3),C(5,"input",4)(6,"input",5),o(7,"button",6),C(8,"i",7),r()()()),n&2&&(s(),E(i.comments),s(2),g("formGroup",i.commentForm),s(4),g("disabled",i.isLoading))},dependencies:[$,O,H,N,j,B,P,G,A,L],styles:[".comments[_ngcontent-%COMP%]{max-height:400px;overflow-y:auto;background-color:#eee}"]})}}return e})();export{pt as CommentsComponent};
